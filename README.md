# SCADA Client Application

–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ SCADA –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–∞–º–∏ –ø–æ –ø—Ä–æ—Ç–æ–∫–æ–ª—É Modbus TCP. –ü–æ—Å—Ç—Ä–æ–µ–Ω–æ –Ω–∞ Avalonia UI (C#) —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º ReactiveUI –¥–ª—è —Ä–µ–∞–∫—Ç–∏–≤–Ω–æ–≥–æ MVVM –∏ FluentModbus –¥–ª—è —Å–≤—è–∑–∏ —Å –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–æ–º.

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

```
Scada.Client/
‚îú‚îÄ‚îÄ Models/           # –ú–æ–¥–µ–ª–∏ –¥–∞–Ω–Ω—ã—Ö (–∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è, —Ä–µ–≥–∏—Å—Ç—Ä—ã)
‚îú‚îÄ‚îÄ ViewModels/       # ViewModels (ReactiveUI)
‚îú‚îÄ‚îÄ Views/            # AXAML –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è (–æ–∫–Ω–∞)
‚îî‚îÄ‚îÄ Services/         # –°–µ—Ä–≤–∏—Å—ã (Modbus-–∫–ª–∏–µ–Ω—Ç)
```

### –°—Ç–µ–∫ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–π

- **.NET 8.0** - –¶–µ–ª–µ–≤–∞—è –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞
- **Avalonia 11.3.6** - –ö—Ä–æ—Å—Å-–ø–ª–∞—Ç—Ñ–æ—Ä–º–µ–Ω–Ω—ã–π UI-—Ñ—Ä–µ–π–º–≤–æ—Ä–∫
- **ReactiveUI** - –†–µ–∞–∫—Ç–∏–≤–Ω–∞—è MVVM-–±–∏–±–ª–∏–æ—Ç–µ–∫–∞
- **FluentModbus 5.3.2** - Modbus TCP/RTU –∫–ª–∏–µ–Ω—Ç

## –°–±–æ—Ä–∫–∞ –∏ –∑–∞–ø—É—Å–∫

### –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

- .NET SDK 8.0 –∏–ª–∏ –≤—ã—à–µ
- Windows / Linux / macOS

### –ö–æ–º–∞–Ω–¥—ã PowerShell

```powershell
# –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
dotnet restore

# –°–±–æ—Ä–∫–∞ —Ä–µ—à–µ–Ω–∏—è
dotnet build Scada.sln

# –ó–∞–ø—É—Å–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
dotnet run --project Scada.Client

# –°–±–æ—Ä–∫–∞ Release
dotnet build -c Release
```

## –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

### 1. –ì–ª–∞–≤–Ω–æ–µ –æ–∫–Ω–æ (–º–Ω–µ–º–æ—Å—Ö–µ–º–∞)
- **Canvas-based –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è** –ø—Ä–æ—Ü–µ—Å—Å–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è
- **–ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–µ –∫–Ω–æ–ø–∫–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è**: CoilButton (M-—Ä–µ–≥–∏—Å—Ç—Ä—ã), ImageButton (X/Y-—Ä–µ–≥–∏—Å—Ç—Ä—ã)
- **–ò–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã**: PumpControl, ValveControl, SensorIndicator
- **Drag & Drop**: –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏–µ —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –Ω–∞ –º–Ω–µ–º–æ—Å—Ö–µ–º–µ (Ctrl+–∫–ª–∏–∫)
- **Copy/Paste**: –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–Ω–æ–ø–æ–∫ (Ctrl+C / Ctrl+V)
- **–ê–≤—Ç–æ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ**: –ø–æ–∑–∏—Ü–∏–∏ –∏ –ø—Ä–∏–≤—è–∑–∫–∏ —Ç—ç–≥–æ–≤ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –ø—Ä–∏ –∑–∞–∫—Ä—ã—Ç–∏–∏ –æ–∫–Ω–∞

### 2. –û–∫–Ω–æ –Ω–∞—Å—Ç—Ä–æ–µ–∫ (Settings)
- **Modbus connection**: Host, Port, Unit ID
- **–ò–Ω—Ç–µ—Ä–≤–∞–ª –æ–ø—Ä–æ—Å–∞**: –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º—ã–π (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 1000 –º—Å)
- **–†–µ–¥–∞–∫—Ç–æ—Ä –∞–∫—Ç–∏–≤–Ω—ã—Ö —Ç—ç–≥–æ–≤**: –≤—ã–±–æ—Ä —Ç—ç–≥–æ–≤ –¥–ª—è –æ–ø—Ä–æ—Å–∞ (—Å–º. [TAG_EDITOR_GUIDE.md](TAG_EDITOR_GUIDE.md))

### 3. –†–µ–¥–∞–∫—Ç–æ—Ä –∞–∫—Ç–∏–≤–Ω—ã—Ö —Ç—ç–≥–æ–≤ ‚≠ê NEW
- **–ü–æ–∏—Å–∫ —Ç—ç–≥–æ–≤**: —Å—Ä–µ–¥–∏ 35,421 —Ç—ç–≥–æ–≤ –∏–∑ `tags.json`
- **–ë—ã—Å—Ç—Ä–æ–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –¥–∏–∞–ø–∞–∑–æ–Ω–∞**: `Y0-Y50`, `M100-M200`, `V512-V600`
- **–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∞–∫—Ç–∏–≤–Ω—ã–º–∏ —Ç—ç–≥–∞–º–∏**: —Ç–æ–ª—å–∫–æ –≤—ã–±—Ä–∞–Ω–Ω—ã–µ —Ç—ç–≥–∏ –æ–ø—Ä–∞—à–∏–≤–∞—é—Ç—Å—è –∏ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ `settings.json`
- **–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤**: Scale, Offset, Enabled –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Ç—ç–≥–∞
- **–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏**: –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π —Ç—Ä–∞—Ñ–∏–∫ Modbus TCP

üìñ **–ü–æ–ª–Ω–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ**: [TAG_EDITOR_GUIDE.md](TAG_EDITOR_GUIDE.md)

## Settings persistence

- **Modbus connection settings**: Host, Port, UnitId
- **Active tags**: —Ç–æ–ª—å–∫–æ –≤—ã–±—Ä–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º —Ç—ç–≥–∏ (—á–µ—Ä–µ–∑ —Ä–µ–¥–∞–∫—Ç–æ—Ä)
- **Mnemoscheme elements**: –ø–æ–∑–∏—Ü–∏–∏ –∫–Ω–æ–ø–æ–∫, –ø—Ä–∏–≤—è–∑–∫–∏ —Ç—ç–≥–æ–≤
- **Storage location**: `%AppData%\Scada.Client\settings.json` (Windows)
- To reset settings, delete this file; defaults will be used on next start.

### 3. Modbus-—Å–µ—Ä–≤–∏—Å
- **IModbusClientService** - –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å Modbus
- **ModbusClientService** - —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è –Ω–∞ FluentModbus
- **Tag-based polling**: –æ–ø—Ä–æ—Å –ø–æ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ —Ç—ç–≥–æ–≤ —Å –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–æ–π –ø–æ —Ç–∏–ø—É —Ä–µ–≥–∏—Å—Ç—Ä–∞
- **Error handling**: –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö –ø—Ä–æ—Ç–æ–∫–æ–ª–∞
- **Fallback strategy**: –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –Ω–∞ –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω–æ–µ —á—Ç–µ–Ω–∏–µ –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö –±–ª–æ—á–Ω–æ–≥–æ —á—Ç–µ–Ω–∏—è
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –æ–ø–µ—Ä–∞—Ü–∏–π:
  - `ReadHoldingRegistersAsync(start, count)` - —á—Ç–µ–Ω–∏–µ Holding —Ä–µ–≥–∏—Å—Ç—Ä–æ–≤ (—Ñ—É–Ω–∫—Ü–∏—è 0x03)
  - `ReadInputRegistersAsync(start, count)` - —á—Ç–µ–Ω–∏–µ Input —Ä–µ–≥–∏—Å—Ç—Ä–æ–≤ (—Ñ—É–Ω–∫—Ü–∏—è 0x04)
  - `ReadCoilsAsync(start, count)` - —á—Ç–µ–Ω–∏–µ Coils (—Ñ—É–Ω–∫—Ü–∏—è 0x01)
  - `ReadDiscreteInputsAsync(start, count)` - —á—Ç–µ–Ω–∏–µ Discrete Inputs (—Ñ—É–Ω–∫—Ü–∏—è 0x02)
  - `WriteCoilAsync(address, value)` - –∑–∞–ø–∏—Å—å –æ–¥–Ω–æ–≥–æ Coil (—Ñ—É–Ω–∫—Ü–∏—è 0x05)
  - `WriteHoldingRegisterAsync(address, value)` - –∑–∞–ø–∏—Å—å —Ä–µ–≥–∏—Å—Ç—Ä–∞ (—Ñ—É–Ω–∫—Ü–∏—è 0x06)

### 4. Tags Configuration
- **tags.json**: –ø–æ–ª–Ω–∞—è –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö —Ç—ç–≥–æ–≤ Haiwell PLC (35,421 —Ç—ç–≥–æ–≤)
- **–¢–∏–ø—ã —Ä–µ–≥–∏—Å—Ç—Ä–æ–≤**: X (Input), Y (Coils), M (Coils), AI/AQ (Input/Holding), V/TV/CV/SV (Holding)
- **–¢–∏–ø—ã –¥–∞–Ω–Ω—ã—Ö**: Bool, UInt16, Int16, UInt32, Int32, Float32, Int64, Double
- **–ê–¥—Ä–µ—Å–∞—Ü–∏—è**: –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ä–∞—Å—á—ë—Ç –∞–¥—Ä–µ—Å–æ–≤ –ø–æ —Ñ–æ—Ä–º—É–ª–∞–º Haiwell
- **–ì–µ–Ω–µ—Ä–∞—Ü–∏—è**: —Å–∫—Ä–∏–ø—Ç `generate_tags.py` –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

–ü–æ–¥—Ä–æ–±–Ω–µ–µ: [ADDRESS_MAP.md](Scada.Client/ADDRESS_MAP.md)

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ MVVM

### ViewModels
- **ViewModelBase** - –±–∞–∑–æ–≤—ã–π –∫–ª–∞—Å—Å –¥–ª—è –≤—Å–µ—Ö VM (–Ω–∞—Å–ª–µ–¥—É–µ—Ç ReactiveObject)
- **MainWindowViewModel** - –≥–ª–∞–≤–Ω–æ–µ –æ–∫–Ω–æ —Å –∫–æ–º–∞–Ω–¥–∞–º–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∏ —á—Ç–µ–Ω–∏—è
- **SettingsWindowViewModel** - –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è

### Views (AXAML)
- **MainWindow** - –º–Ω–µ–º–æ—Å—Ö–µ–º–∞, –æ–±–ª–∞—Å—Ç—å –¥–ª—è –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏ –ø—Ä–æ—Ü–µ—Å—Å–∞
- **SettingsWindow** - –¥–∏–∞–ª–æ–≥ –Ω–∞—Å—Ç—Ä–æ–µ–∫

### –ö–æ–º–∞–Ω–¥—ã (ReactiveCommand)
- `ConnectCommand` - –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä—É
- `DisconnectCommand` - –æ—Ç–∫–ª—é—á–µ–Ω–∏–µ
- `ReadRegisterCommand` - —á—Ç–µ–Ω–∏–µ —Ä–µ–≥–∏—Å—Ç—Ä–∞ (–¥–æ—Å—Ç—É–ø–Ω–∞ —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–∏)
- `OpenSettingsCommand` - –æ—Ç–∫—Ä—ã—Ç–∏–µ –Ω–∞—Å—Ç—Ä–æ–µ–∫

## –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

### –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏ –Ω–∞ –º–Ω–µ–º–æ—Å—Ö–µ–º—É

1. –°–æ–∑–¥–∞–π—Ç–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π –∫–æ–Ω—Ç—Ä–æ–ª –≤ `Views/Controls/`
2. –î–æ–±–∞–≤—å—Ç–µ —Å–≤–æ–π—Å—Ç–≤–∞ —Å –ø—Ä–∏–≤—è–∑–∫–æ–π –∫ –¥–∞–Ω–Ω—ã–º –∏–∑ ViewModel
3. –û–±–Ω–æ–≤–∏—Ç–µ `MainWindowViewModel`, –¥–æ–±–∞–≤—å—Ç–µ —Ç–∞–π–º–µ—Ä –¥–ª—è –æ–ø—Ä–æ—Å–∞ —Ä–µ–≥–∏—Å—Ç—Ä–æ–≤:

```csharp
private System.Timers.Timer _pollTimer;

public MainWindowViewModel()
{
    // ...
    _pollTimer = new System.Timers.Timer(1000); // 1 sec
    _pollTimer.Elapsed += async (s, e) => await PollRegistersAsync();
}

private async Task PollRegistersAsync()
{
    if (!IsConnected) return;
    RegisterValue = await _modbusService.ReadHoldingRegisterAsync(RegisterAddress);
}
```

### –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –æ–∫–Ω–∞

1. –°–æ–∑–¥–∞–π—Ç–µ AXAML + code-behind –≤ `Views/`
2. –°–æ–∑–¥–∞–π—Ç–µ ViewModel –≤ `ViewModels/`
3. –í –∫–æ–º–∞–Ω–¥–µ –∏–∑ MainWindowViewModel:

```csharp
private async void OpenNewWindow()
{
    var vm = new NewWindowViewModel();
    var window = new NewWindow { DataContext = vm };
    await window.ShowDialog(this);
}
```

## –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ —Ä–µ–∞–ª—å–Ω–æ–º—É –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä—É

–ü–æ —É–º–æ–ª—á–∞–Ω–∏—é –Ω–∞—Å—Ç—Ä–æ–π–∫–∏:
- **Host**: `127.0.0.1`
- **Port**: `502`
- **Unit ID**: `1`

–ò–∑–º–µ–Ω–∏—Ç–µ –≤ `MainWindowViewModel.ConnectAsync()` –∏–ª–∏ —á–µ—Ä–µ–∑ –æ–∫–Ω–æ –Ω–∞—Å—Ç—Ä–æ–µ–∫ (–≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ).

–î–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –±–µ–∑ —Ñ–∏–∑–∏—á–µ—Å–∫–æ–≥–æ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–∞ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ Modbus-—Å–∏–º—É–ª—è—Ç–æ—Ä—ã:
- **ModRSsim2** (Windows)
- **diagslave** (Linux/macOS)

```powershell
# –ü—Ä–∏–º–µ—Ä –∑–∞–ø—É—Å–∫–∞ diagslave –Ω–∞ –ø–æ—Ä—Ç—É 502
diagslave -m tcp -p 502
```

## –ò–∑–≤–µ—Å—Ç–Ω—ã–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è

- NModbus4 —É—Å—Ç–∞—Ä–µ–ª (—Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å .NET Framework), –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è FluentModbus
- –û–∫–Ω–æ –Ω–∞—Å—Ç—Ä–æ–µ–∫ —Å–æ–∑–¥–∞–Ω–æ, –Ω–æ –Ω–µ –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω–æ —Å MainWindowViewModel (TODO)
- –ú–Ω–µ–º–æ—Å—Ö–µ–º–∞ - –ø–æ–∫–∞ –∑–∞–≥–æ—Ç–æ–≤–∫–∞ –±–µ–∑ –≤–∏–∑—É–∞–ª—å–Ω—ã—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤

## –õ–∏—Ü–µ–Ω–∑–∏—è

–í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π –ø—Ä–æ–µ–∫—Ç.
