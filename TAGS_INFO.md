# Информация о тегах Modbus в SCADA приложении

## Типы тегов по адресам

### X-теги (Входы) — READ ONLY ❌
- **Адреса:** 0 - 1535
- **Назначение:** Дискретные входы контроллера
- **Запись:** ❌ НЕЛЬЗЯ записывать (read-only)
- **Использование:** Только для мониторинга состояния входов
- **Примеры:** X0, X1, X2, ... X39

⚠️ **ВАЖНО:** X-теги НЕЛЬЗЯ назначать кнопкам управления!

### Y-теги (Выходы) — WRITABLE ✅
- **Адреса:** 1536 - 3071
- **Назначение:** Дискретные выходы контроллера
- **Запись:** ✅ МОЖНО записывать
- **Использование:** Управление физическими выходами (реле, контакторы и т.д.)
- **Примеры:** Y0 (1536), Y1 (1537), Y2 (1538), ...

### M-теги (Внутренние флаги) — WRITABLE ✅
- **Адреса:** 3072 - ...
- **Назначение:** Внутренние флаги/переменные контроллера
- **Запись:** ✅ МОЖНО записывать
- **Использование:** Логические переменные, состояния, команды
- **Примеры:** M0 (3072), M1 (3073), M2 (3074), ...

## Настройки по умолчанию в приложении

### Адреса кнопок (используют M-теги)
```
Coil1 (Кнопка 0):  M0 - адрес 3072
Coil2 (Кнопка 1):  M1 - адрес 3073
Coil3 (Кнопка 2):  M2 - адрес 3074
Motor (Мотор):     M3 - адрес 3075
Valve (Клапан):    M4 - адрес 3076
Fan (Вентилятор):  M5 - адрес 3077
```

## Назначение тега кнопке

### Как открыть диалог выбора тега
1. **Правый клик** на кнопке (CoilButton или ImageButton)
2. Откроется диалог "Настройки кнопки"

### Фильтрация тегов в диалоге
- Показываются только **Y и M теги** (адреса >= 1536)
- X-теги (входы) **автоматически скрываются**
- Первоначально показывается **200 первых тегов**
- Используйте **поиск** для фильтрации по имени или адресу

### Поиск тега
Введите в поле поиска:
- **Имя тега:** `M5` — найдёт все M5, M50, M500...
- **Адрес:** `3077` — найдёт теги с этим адресом
- **Часть имени:** `Motor` — найдёт M3_Motor и другие

### Производительность
- **Без фильтра:** показано первых 200 из ~10000 Y/M тегов
- **С фильтром:** показано до 200 результатов поиска
- **Время отклика:** <100ms вместо зависания

## Решение проблем

### Программа зависает при открытии диалога
✅ **Исправлено:**
- Добавлена фильтрация по адресам (только Y/M теги)
- Ограничение до 500 тегов при загрузке
- Показ только 200 тегов без фильтра
- Лимит 200 результатов при поиске

### Кнопка не включает катушку
❌ **Причина:** Назначен X-тег (read-only вход)
✅ **Решение:** Назначьте M или Y тег через правый клик

### Тег не найден в списке
✅ **Решение:**
1. Используйте поиск по имени (M5, Y10)
2. Или введите адрес напрямую (3077, 1540)
3. Убедитесь, что тег включен (Enabled=true) в tags.json

## Примеры использования

### Управление реле (Y-теги)
```
Y0 (1536) → Реле 1
Y1 (1537) → Реле 2
Y2 (1538) → Реле 3
```

### Логические команды (M-теги)
```
M0 (3072) → Команда Пуск
M1 (3073) → Команда Стоп
M2 (3074) → Режим Auto/Manual
```

### Мониторинг входов (X-теги)
```
X0 (0) → Кнопка START (только чтение!)
X1 (1) → Датчик уровня (только чтение!)
```

## Архитектура тегов в tags.json

Файл содержит ~196000 тегов:
- X-теги: ~10000 (адреса 0-9999)
- Y-теги: ~10000 (адреса 1536-11535)
- M-теги: ~176000 (адреса 3072-179071)

При первом запуске приложения теги загружаются из `tags.json` в `settings.json`.

## Быстрая проверка

### Проверить текущие адреса кнопок
1. Запустите приложение
2. Правый клик на кнопке
3. Посмотрите "Текущий адрес"

### Проверить доступные теги
```powershell
# Показать все M-теги
(Get-Content "Scada.Client/tags.json" | ConvertFrom-Json).Tags | 
  Where-Object { $_.Name -like "M*" } | 
  Select-Object Name, Address -First 20
```

## Дополнительная информация

- **Modbus Function Code для Coils:** FC01 (Read), FC05 (Write Single), FC15 (Write Multiple)
- **Регистры Holding:** адреса 0+ (для аналоговых значений)
- **Регистры Input:** адреса 0+ (только чтение, аналоговые входы)
