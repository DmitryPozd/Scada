<Window xmlns="https://github.com/avaloniaui"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:vm="using:Scada.Client.ViewModels"
    xmlns:controls="using:Scada.Client.Views.Controls"
        mc:Ignorable="d" d:DesignWidth="1920" d:DesignHeight="1080"
        x:Class="Scada.Client.Views.MainWindow"
        x:DataType="vm:MainWindowViewModel"
        Title="SCADA - Мнемосхема"
        Width="1920" Height="1080">
    
    <Grid RowDefinitions="Auto,*,Auto" Margin="10">
        <!-- Connection Status Bar -->
        <Border Grid.Row="0" 
                Background="{DynamicResource AccentFillColorDefaultBrush}" 
                Padding="10" 
                CornerRadius="5" 
                Margin="0,0,0,10">
            <Grid ColumnDefinitions="*,Auto,Auto">
                <TextBlock Text="{Binding ConnectionStatus}" 
                           Foreground="{DynamicResource TextOnAccentFillColorPrimaryBrush}" 
                           VerticalAlignment="Center" 
                           FontSize="14"/>
                <Button Grid.Column="1" Content="Подключить" Command="{Binding ConnectCommand}" 
                        IsEnabled="{Binding !IsConnected}" Margin="5,0" Padding="15,5"/>
                <Button Grid.Column="2" Content="Отключить" Command="{Binding DisconnectCommand}" 
                        IsEnabled="{Binding IsConnected}" Padding="15,5"/>
            </Grid>
        </Border>

        <!-- Main Content - Mnemoscheme Area -->
        <Border Grid.Row="1" 
                BorderBrush="{DynamicResource CardStrokeColorDefaultBrush}" 
                BorderThickness="2" 
                CornerRadius="5" 
                Background="{DynamicResource SolidBackgroundFillColorBaseBrush}">
            <Grid RowDefinitions="Auto,*">
                <!-- Toolbar -->
                <Border Grid.Row="0" 
                        Background="{DynamicResource CardBackgroundFillColorDefaultBrush}" 
                        BorderBrush="{DynamicResource DividerStrokeColorDefaultBrush}" 
                        BorderThickness="0,0,0,1" 
                        Padding="10">
                    <StackPanel Spacing="10">
                        <TextBlock Text="Мнемосхема SCADA - перемещайте элементы мышью" FontSize="16" FontWeight="Bold"/>
                        
                        <!-- Test Register Read -->
                        <Grid ColumnDefinitions="Auto,200,Auto,150,Auto,100" RowDefinitions="Auto,Auto">
                            <TextBlock Grid.Column="0" Text="Тег:" VerticalAlignment="Center" Margin="0,0,10,0"/>
                            <ComboBox Grid.Column="1"
                                      ItemsSource="{Binding ConnectionConfig.Tags}"
                                      SelectedItem="{Binding SelectedTag}"
                                      MinWidth="180">
                                <ComboBox.ItemTemplate>
                                    <DataTemplate>
                                        <TextBlock Text="{Binding Name}"/>
                                    </DataTemplate>
                                </ComboBox.ItemTemplate>
                            </ComboBox>

                            <TextBlock Grid.Column="2" Text="Адрес:" VerticalAlignment="Center" Margin="15,0,10,0"/>
                            <NumericUpDown Grid.Column="3" Value="{Binding RegisterAddress}"
                                           Minimum="0" Maximum="65535" Increment="1"/>

                            <Button Grid.Column="4" Content="Читать" Command="{Binding ReadRegisterCommand}"
                                    Margin="10,0" Padding="15,5"/>
                            <TextBlock Grid.Column="5" Text="{Binding RegisterValue}"
                                       VerticalAlignment="Center" FontSize="16" FontWeight="Bold"/>
                            
                            <!-- Coil write controls -->
                            <StackPanel Grid.Row="1" Grid.ColumnSpan="6" Orientation="Horizontal" Spacing="8" Margin="0,8,0,0">
                                <TextBlock Text="Coil запись:" VerticalAlignment="Center"/>
                                <Button Content="ON" Command="{Binding CoilOnCommand}" Padding="12,4"/>
                                <Button Content="OFF" Command="{Binding CoilOffCommand}" Padding="12,4"/>
                            </StackPanel>
                        </Grid>
                    </StackPanel>
                </Border>

                <!-- Canvas for Mnemoscheme -->
                <Canvas x:Name="MnemoCanvas" 
                        Grid.Row="1" 
                        Background="{DynamicResource LayerFillColorDefaultBrush}" 
                        ClipToBounds="True">
                    
                    <!-- Pump Control -->
                    <controls:DraggableControl X="50" Y="50">
                        <controls:PumpControl Label="Насос 1"
                                              IsRunning="{Binding Pump1Running}"
                                              HasAlarm="{Binding Pump1Alarm}"/>
                    </controls:DraggableControl>

                    <!-- Valve Control -->
                    <controls:DraggableControl X="300" Y="50">
                        <controls:ValveControl Label="Клапан 1"
                                                OpenPercent="{Binding Valve1OpenPercent}"
                                                HasAlarm="False"/>
                    </controls:DraggableControl>

                    <!-- Sensor Indicator -->
                    <controls:DraggableControl X="550" Y="50">
                        <controls:SensorIndicator Label="Давление"
                                                  Value="{Binding Sensor1Value}"
                                                  Unit="бар"
                                                  ThresholdLow="1.0"
                                                  ThresholdHigh="8.0"/>
                    </controls:DraggableControl>

                    <!-- CoilButton 1 -->
                    <controls:DraggableControl X="50" Y="200">
                        <controls:CoilButton Label="Кнопка 0"
                                            IsActive="{Binding Coil1Active}"
                                            CoilAddress="{Binding Coil1Address, Mode=TwoWay}"
                                            AvailableTags="{Binding ConnectionConfig.Tags}"
                                            OnCommand="{Binding Coil1OnCommand}"
                                            OffCommand="{Binding Coil1OffCommand}"/>
                    </controls:DraggableControl>

                    <!-- CoilButton 2 -->
                    <controls:DraggableControl X="300" Y="200">
                        <controls:CoilButton Label="Кнопка 1"
                                            IsActive="{Binding Coil2Active}"
                                            CoilAddress="{Binding Coil2Address, Mode=TwoWay}"
                                            AvailableTags="{Binding ConnectionConfig.Tags}"
                                            OnCommand="{Binding Coil2OnCommand}"
                                            OffCommand="{Binding Coil2OffCommand}"/>
                    </controls:DraggableControl>

                    <!-- CoilButton 3 -->
                    <controls:DraggableControl X="550" Y="200">
                        <controls:CoilButton Label="Кнопка 2"
                                            IsActive="{Binding Coil3Active}"
                                            CoilAddress="{Binding Coil3Address, Mode=TwoWay}"
                                            AvailableTags="{Binding ConnectionConfig.Tags}"
                                            OnCommand="{Binding Coil3OnCommand}"
                                            OffCommand="{Binding Coil3OffCommand}"/>
                    </controls:DraggableControl>

                    <!-- ImageButton Motor -->
                    <controls:DraggableControl X="50" Y="320">
                        <controls:ImageButton Label="Мотор"
                                             ImageType="Motor"
                                             IsActive="{Binding MotorActive}"
                                             CoilAddress="{Binding MotorAddress, Mode=TwoWay}"
                                             AvailableTags="{Binding ConnectionConfig.Tags}"
                                             OnCommand="{Binding MotorOnCommand}"
                                             OffCommand="{Binding MotorOffCommand}"/>
                    </controls:DraggableControl>

                    <!-- ImageButton Valve -->
                    <controls:DraggableControl X="300" Y="320">
                        <controls:ImageButton Label="Клапан"
                                             ImageType="Valve"
                                             IsActive="{Binding ValveActive}"
                                             CoilAddress="{Binding ValveAddress, Mode=TwoWay}"
                                             AvailableTags="{Binding ConnectionConfig.Tags}"
                                             OnCommand="{Binding ValveOnCommand}"
                                             OffCommand="{Binding ValveOffCommand}"/>
                    </controls:DraggableControl>

                    <!-- ImageButton Fan -->
                    <controls:DraggableControl X="550" Y="320">
                        <controls:ImageButton Label="Вентилятор"
                                             ImageType="Fan"
                                             IsActive="{Binding FanActive}"
                                             CoilAddress="{Binding FanAddress, Mode=TwoWay}"
                                             AvailableTags="{Binding ConnectionConfig.Tags}"
                                             OnCommand="{Binding FanOnCommand}"
                                             OffCommand="{Binding FanOffCommand}"/>
                    </controls:DraggableControl>

                    <!-- CoilReadButton -->
                    <controls:DraggableControl X="50" Y="440">
                        <controls:CoilReadButton Label="Чтение катушки"
                                                CoilAddress="{Binding ReadCoilAddress, Mode=TwoWay}"
                                                CoilValue="{Binding ReadCoilValue}"
                                                AvailableTags="{Binding ConnectionConfig.Tags}"
                                                ReadCommand="{Binding ReadCoilCommand}"/>
                    </controls:DraggableControl>

                </Canvas>
            </Grid>
        </Border>

        <!-- Bottom Action Bar -->
        <StackPanel Grid.Row="2" Orientation="Horizontal" HorizontalAlignment="Right" Margin="0,10,0,0" Spacing="10">
            <Button Content="Настройки" Command="{Binding OpenSettingsCommand}" Padding="15,5"/>
        </StackPanel>
    </Grid>
</Window>
