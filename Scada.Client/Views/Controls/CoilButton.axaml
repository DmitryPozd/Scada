<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:controls="using:Scada.Client.Views.Controls"
             x:Class="Scada.Client.Views.Controls.CoilButton"
             Width="90" Height="100">
  
  <!-- Кликабельная кнопка -->
  <Button x:Name="MainButton"
          Click="OnToggleClick"
          Padding="8"
          CornerRadius="8"
          Background="{DynamicResource ControlFillColorDefaultBrush}"
          BorderBrush="{DynamicResource ControlStrokeColorDefaultBrush}"
          BorderThickness="1">
    <StackPanel Spacing="6" HorizontalAlignment="Center">
      <!-- Название -->
      <TextBlock Text="{Binding Label, RelativeSource={RelativeSource AncestorType=controls:CoilButton}}"
                 FontWeight="SemiBold" 
                 HorizontalAlignment="Center" 
                 FontSize="11"
                 TextWrapping="Wrap"
                 TextAlignment="Center"/>
      
      <!-- Визуальный индикатор состояния -->
      <Border Width="50" Height="35" CornerRadius="6" BorderThickness="2">
        <Border.BorderBrush>
          <Binding Path="IsActive" RelativeSource="{RelativeSource AncestorType=controls:CoilButton}">
            <Binding.Converter>
              <controls:CoilStateBorderConverter/>
            </Binding.Converter>
          </Binding>
        </Border.BorderBrush>
        <Border.Background>
          <Binding Path="IsActive" RelativeSource="{RelativeSource AncestorType=controls:CoilButton}">
            <Binding.Converter>
              <controls:CoilStateBackgroundConverter/>
            </Binding.Converter>
          </Binding>
        </Border.Background>
        <Grid>
          <!-- Иконка ON (когда активна и есть IconPathOn) -->
          <Image Name="IconOn" Stretch="Uniform">
            <Image.IsVisible>
              <MultiBinding Converter="{x:Static BoolConverters.And}">
                <Binding Path="IsActive" RelativeSource="{RelativeSource AncestorType=controls:CoilButton}" />
                <Binding Path="IconPathOn" RelativeSource="{RelativeSource AncestorType=controls:CoilButton}" Converter="{x:Static ObjectConverters.IsNotNull}" />
              </MultiBinding>
            </Image.IsVisible>
            <Image.Source>
              <Binding Path="IconPathOn" RelativeSource="{RelativeSource AncestorType=controls:CoilButton}">
                <Binding.Converter>
                  <controls:PathToImageConverter/>
                </Binding.Converter>
              </Binding>
            </Image.Source>
          </Image>
          
          <!-- Иконка OFF (когда не активна и есть IconPathOff) -->
          <Image Name="IconOff" Stretch="Uniform">
            <Image.IsVisible>
              <MultiBinding Converter="{x:Static BoolConverters.And}">
                <Binding Path="IsActive" RelativeSource="{RelativeSource AncestorType=controls:CoilButton}" Converter="{x:Static BoolConverters.Not}" />
                <Binding Path="IconPathOff" RelativeSource="{RelativeSource AncestorType=controls:CoilButton}" Converter="{x:Static ObjectConverters.IsNotNull}" />
              </MultiBinding>
            </Image.IsVisible>
            <Image.Source>
              <Binding Path="IconPathOff" RelativeSource="{RelativeSource AncestorType=controls:CoilButton}">
                <Binding.Converter>
                  <controls:PathToImageConverter/>
                </Binding.Converter>
              </Binding>
            </Image.Source>
          </Image>
          
          <!-- Старая иконка (для обратной совместимости, если используется IconPath) -->
          <Image Name="IconLegacy" Stretch="Uniform">
            <Image.IsVisible>
              <MultiBinding Converter="{x:Static BoolConverters.And}">
                <Binding Path="IconPath" RelativeSource="{RelativeSource AncestorType=controls:CoilButton}" Converter="{x:Static ObjectConverters.IsNotNull}" />
                <Binding Path="IconPathOn" RelativeSource="{RelativeSource AncestorType=controls:CoilButton}" Converter="{x:Static ObjectConverters.IsNull}" />
                <Binding Path="IconPathOff" RelativeSource="{RelativeSource AncestorType=controls:CoilButton}" Converter="{x:Static ObjectConverters.IsNull}" />
              </MultiBinding>
            </Image.IsVisible>
            <Image.Source>
              <Binding Path="IconPath" RelativeSource="{RelativeSource AncestorType=controls:CoilButton}">
                <Binding.Converter>
                  <controls:PathToImageConverter/>
                </Binding.Converter>
              </Binding>
            </Image.Source>
          </Image>
          
          <!-- Текстовая иконка состояния (если нет изображений) -->
          <TextBlock Name="DefaultIcon">
            <TextBlock.IsVisible>
              <MultiBinding Converter="{x:Static BoolConverters.And}">
                <Binding Path="IconPath" RelativeSource="{RelativeSource AncestorType=controls:CoilButton}" Converter="{x:Static ObjectConverters.IsNull}" />
                <Binding Path="IconPathOn" RelativeSource="{RelativeSource AncestorType=controls:CoilButton}" Converter="{x:Static ObjectConverters.IsNull}" />
                <Binding Path="IconPathOff" RelativeSource="{RelativeSource AncestorType=controls:CoilButton}" Converter="{x:Static ObjectConverters.IsNull}" />
              </MultiBinding>
            </TextBlock.IsVisible>
            <TextBlock.FontSize>18</TextBlock.FontSize>
            <TextBlock.HorizontalAlignment>Center</TextBlock.HorizontalAlignment>
            <TextBlock.VerticalAlignment>Center</TextBlock.VerticalAlignment>
            <TextBlock.FontWeight>Bold</TextBlock.FontWeight>
            <TextBlock.Text>
              <Binding Path="IsActive" RelativeSource="{RelativeSource AncestorType=controls:CoilButton}">
                <Binding.Converter>
                  <controls:CoilStateIconConverter/>
                </Binding.Converter>
              </Binding>
            </TextBlock.Text>
            <TextBlock.Foreground>
              <Binding Path="IsActive" RelativeSource="{RelativeSource AncestorType=controls:CoilButton}">
                <Binding.Converter>
                  <controls:CoilStateTextColorConverter/>
                </Binding.Converter>
              </Binding>
            </TextBlock.Foreground>
          </TextBlock>
        </Grid>
      </Border>
      
      <!-- Текстовый индикатор -->
      <TextBlock FontSize="10" FontWeight="SemiBold" HorizontalAlignment="Center">
        <TextBlock.Text>
          <Binding Path="IsActive" RelativeSource="{RelativeSource AncestorType=controls:CoilButton}">
            <Binding.Converter>
              <controls:CoilStateTextConverter/>
            </Binding.Converter>
          </Binding>
        </TextBlock.Text>
      </TextBlock>
    </StackPanel>
  </Button>
  
</UserControl>
